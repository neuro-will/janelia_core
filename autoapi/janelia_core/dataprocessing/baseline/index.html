<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>janelia_core.dataprocessing.baseline &mdash; janelia_core 0.1 documentation</title><link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> janelia_core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">janelia_core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">janelia_core.dataprocessing.baseline</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/autoapi/janelia_core/dataprocessing/baseline/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-janelia_core.dataprocessing.baseline">
<span id="janelia-core-dataprocessing-baseline"></span><h1><a class="reference internal" href="#module-janelia_core.dataprocessing.baseline" title="janelia_core.dataprocessing.baseline"><code class="xref py py-mod docutils literal notranslate"><span class="pre">janelia_core.dataprocessing.baseline</span></code></a><a class="headerlink" href="#module-janelia_core.dataprocessing.baseline" title="Permalink to this headline"></a></h1>
<p>Tools for calculating baseline values for fluorescence data.</p>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline"></a></h2>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#janelia_core.dataprocessing.baseline.percentile_filter_1d" title="janelia_core.dataprocessing.baseline.percentile_filter_1d"><code class="xref py py-obj docutils literal notranslate"><span class="pre">percentile_filter_1d</span></code></a>(data: numpy.ndarray, window_length: int, filter_start: int, write_offset: int, p: float, n_hist_bins: int = 1000) → numpy.ndarray</p></td>
<td><p>Performs percentile filtering for a single variable.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#janelia_core.dataprocessing.baseline.percentile_filter_multi_d" title="janelia_core.dataprocessing.baseline.percentile_filter_multi_d"><code class="xref py py-obj docutils literal notranslate"><span class="pre">percentile_filter_multi_d</span></code></a>(data: numpy.ndarray, window_length: int, filter_start: int, write_offset, p: float, mask: numpy.ndarray = None, n_processes: int = 1) → numpy.ndarray</p></td>
<td><p>Calculates baselines independently for each variable in the data across time.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#janelia_core.dataprocessing.baseline._percentile_filter_arg_unpack" title="janelia_core.dataprocessing.baseline._percentile_filter_arg_unpack"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_percentile_filter_arg_unpack</span></code></a>(kwargs)</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#janelia_core.dataprocessing.baseline.calculate_causal_percentile_baseline" title="janelia_core.dataprocessing.baseline.calculate_causal_percentile_baseline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calculate_causal_percentile_baseline</span></code></a>(data: numpy.ndarray, window_size: int, p: float, n_hist_bins: int = 1000) → numpy.ndarray</p></td>
<td><p>Calculates percentile based baseline in causal manner for one variable.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#janelia_core.dataprocessing.baseline.calculate_causal_percentile_baselines" title="janelia_core.dataprocessing.baseline.calculate_causal_percentile_baselines"><code class="xref py py-obj docutils literal notranslate"><span class="pre">calculate_causal_percentile_baselines</span></code></a>(data: numpy.ndarray, window_size: int, p: float, n_hist_bins: int = 1000, n_processes=None) → numpy.ndarray</p></td>
<td><p>A wrapper function for calculating baseline values for multiple variables in parallel.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt id="janelia_core.dataprocessing.baseline.percentile_filter_1d">
<code class="sig-prename descclassname">janelia_core.dataprocessing.baseline.</code><code class="sig-name descname">percentile_filter_1d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">window_length</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">filter_start</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">write_offset</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">p</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)">float</a></span></em>, <em class="sig-param"><span class="n">n_hist_bins</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span> <span class="o">=</span> <span class="default_value">1000</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../../../../_modules/janelia_core/dataprocessing/baseline.html#percentile_filter_1d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#janelia_core.dataprocessing.baseline.percentile_filter_1d" title="Permalink to this definition"></a></dt>
<dd><p>Performs percentile filtering for a single variable.</p>
<p>This function uses a moving window to calculate percentiles.  The window is determined by two parameters:
window_length and filter_start. Window_length is the number of data points in the window.</p>
<p>The location in the data where filtering is started is determined by filter_start, which gives the
index of the first value of data that should be in the window.  Negative filter_starts are acceptable
to indicate a window which begins only partially overlapping the data.</p>
<p>Finally, write_offset is the offset between the first sample in the window and the sample in the
output the filtered value should be assigned to.</p>
<p>Note that windows at the beginning and end of the data may only partially overlap the data.  In these
cases, only values in the window will be used for calculating percentiles.</p>
<p>Here are some examples.  To perform standard, acausal filtering with a window of size 101 set:</p>
<blockquote>
<div><p>window_length = 101</p>
<p>filter_start = -50</p>
<p>write_offset = 50</p>
</div></blockquote>
<p>To perform standard, causal filtering with a window of size 101 set:</p>
<blockquote>
<div><p>window_length = 101</p>
<p>filter_start: 0</p>
<p>write_offset = 100</p>
</div></blockquote>
<p>Diagram of window placement and parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Location</span> <span class="n">of</span> <span class="n">first</span> <span class="n">window</span> <span class="k">for</span> <span class="n">filtering</span><span class="p">:</span>

                   <span class="o">|--------------------|</span><span class="p">:</span> <span class="n">Window</span> <span class="n">length</span>
                <span class="n">t</span><span class="o">=</span><span class="mi">0</span>
                <span class="o">|</span>
          <span class="n">Data</span><span class="p">:</span> <span class="n">XXX</span><span class="o">|</span><span class="n">XXXXXXXXXXXXXXXXXXXX</span><span class="o">|</span><span class="n">XXXX</span>
                   <span class="o">^</span>                    <span class="o">^</span>
                   <span class="o">|</span>                    <span class="o">|</span>
                   <span class="nb">filter</span> <span class="n">start</span>         <span class="n">window</span> <span class="n">end</span>

<span class="n">Filtered</span> <span class="n">Data</span><span class="p">:</span>    <span class="o">|----------|</span><span class="p">:</span> <span class="n">Write</span> <span class="n">offset</span>
               <span class="n">YYY</span><span class="o">|</span><span class="n">YYYYYYYYYYYYYYYYYYYY</span><span class="o">|</span><span class="n">YYYY</span>
                             <span class="o">^</span>
                             <span class="o">|</span>
                 <span class="n">filtered</span> <span class="n">value</span> <span class="n">written</span> <span class="n">here</span>
</pre></div>
</div>
<p>Args:</p>
<blockquote>
<div><p>data: an array of data.</p>
<p>window_length: The length of samples in a window</p>
<p>filter_start: The index into the data for the start of the first window.  Negative values indicate
the first window only partially overlaps the data.</p>
<p>write_offset: The offset between the first entry in a window and the sample in the output the filtered
value is written to.</p>
<p>p: The percentile to use in the baseline calculations.</p>
<p>n_hist_bins: Percentiles are calculated using a histogram binning technique to improve computational
efficiency.  This is the number of bins to use in the histogram between the min and max value in the data.</p>
</div></blockquote>
<p>Returns:</p>
<blockquote>
<div><p>y: The filtered data.  The same shape as one time point of data. Any points for which a percentile was not
calculated will be nan.</p>
</div></blockquote>
<p>Raises:</p>
<blockquote>
<div><p>RuntimeError: If data with more than 2 dimensions is given as input data</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="janelia_core.dataprocessing.baseline.percentile_filter_multi_d">
<code class="sig-prename descclassname">janelia_core.dataprocessing.baseline.</code><code class="sig-name descname">percentile_filter_multi_d</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">window_length</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">filter_start</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">write_offset</span></em>, <em class="sig-param"><span class="n">p</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)">float</a></span></em>, <em class="sig-param"><span class="n">mask</span><span class="p">:</span> <span class="n">numpy.ndarray</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">n_processes</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span> <span class="o">=</span> <span class="default_value">1</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../../../../_modules/janelia_core/dataprocessing/baseline.html#percentile_filter_multi_d"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#janelia_core.dataprocessing.baseline.percentile_filter_multi_d" title="Permalink to this definition"></a></dt>
<dd><p>Calculates baselines independently for each variable in the data across time.</p>
<p>This function is a wrapper around percentile_filter_1d.  It adds the ability to filter in parellel on
machines with multiple cores and to filter a restricted set of variabels in a volume, indicated by a mask.</p>
<dl>
<dt>Args:</dt><dd><p>data: an array of data.  First dimension is time.</p>
<p>window_length, filter_start, write_offset, p: See percentile_filter</p>
<p>mask: A boolean array the size of one time point of data.  Entries with a value of 1 indicate percentiles for
that variable should be calculated.  If None, percentiles for all variables will be calculated.</p>
<p>n_processes: The number of processes to use when calculating baselines.  When calculating baselines for many
variables on machines with multiple cores, setting this greater than 1 can improve computation time.</p>
</dd>
</dl>
<p>Returns:</p>
<blockquote>
<div><p>y: The filtered data.  The same shape as one time point of data.  If a mask was used so percentiles were not
calculated for some variables, the percentiles for these variables will be nan.</p>
</div></blockquote>
<dl class="simple">
<dt>Raises:</dt><dd><p>RuntimeError: If data with more than 2 dimensions is given as input data</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="janelia_core.dataprocessing.baseline._percentile_filter_arg_unpack">
<code class="sig-prename descclassname">janelia_core.dataprocessing.baseline.</code><code class="sig-name descname">_percentile_filter_arg_unpack</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../_modules/janelia_core/dataprocessing/baseline.html#_percentile_filter_arg_unpack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#janelia_core.dataprocessing.baseline._percentile_filter_arg_unpack" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="janelia_core.dataprocessing.baseline.calculate_causal_percentile_baseline">
<code class="sig-prename descclassname">janelia_core.dataprocessing.baseline.</code><code class="sig-name descname">calculate_causal_percentile_baseline</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">window_size</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">p</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)">float</a></span></em>, <em class="sig-param"><span class="n">n_hist_bins</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span> <span class="o">=</span> <span class="default_value">1000</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../../../../_modules/janelia_core/dataprocessing/baseline.html#calculate_causal_percentile_baseline"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#janelia_core.dataprocessing.baseline.calculate_causal_percentile_baseline" title="Permalink to this definition"></a></dt>
<dd><p>Calculates percentile based baseline in causal manner for one variable.</p>
<p>The value baseline[i] is calculated as the p-th percentile in the window data[i-window_size+1:i+1].</p>
<p>Values of baseline[0:window_size] = NAN.</p>
<p>If data is all a constant value, the non-NAN values in the returned baseline will be that constant value.</p>
<dl>
<dt>Args:</dt><dd><p>data: a 1-d array of data</p>
<p>window_size: The size of the window to use (units are number of samples)</p>
<p>p: The percentile to use in the baseline calculations.  Must be in the range [0, 1)</p>
<p>n_hist_bins: The number of bins to use when calculating histograms for the baseline calculations.</p>
</dd>
<dt>Returns:</dt><dd><p>baseline - an array the same shape as data giving the calculated baseline value at each point.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="janelia_core.dataprocessing.baseline.calculate_causal_percentile_baselines">
<code class="sig-prename descclassname">janelia_core.dataprocessing.baseline.</code><code class="sig-name descname">calculate_causal_percentile_baselines</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">window_size</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span></em>, <em class="sig-param"><span class="n">p</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)">float</a></span></em>, <em class="sig-param"><span class="n">n_hist_bins</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></span> <span class="o">=</span> <span class="default_value">1000</span></em>, <em class="sig-param"><span class="n">n_processes</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../../../../_modules/janelia_core/dataprocessing/baseline.html#calculate_causal_percentile_baselines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#janelia_core.dataprocessing.baseline.calculate_causal_percentile_baselines" title="Permalink to this definition"></a></dt>
<dd><p>A wrapper function for calculating baseline values for multiple variables in parallel.</p>
<p>This function wraps around calculate_causal_percentile_baseline, allowing a user to use multiple
cores to calculate baselines in parallel.</p>
<dl>
<dt>Args:</dt><dd><p>data: An array or size time * (data_shape) with data to calculate baselines for.  Here data_shape is the shape
of the data at each point in time.</p>
<p>window_size: See calculate_causal_percentile_baseline()</p>
<p>p: See calculate_causal_percentile_baseline()</p>
<p>n_hist_bins: See calculate_causal_percentile_baseline()</p>
<p>n_processes: The number of processes to use.  If none, this will be set to the number of processors on the
machine.</p>
</dd>
<dt>Returns:</dt><dd><p>baselines - The baselines for the variables.  Will be the same shape as data.</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, William Bishop.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>